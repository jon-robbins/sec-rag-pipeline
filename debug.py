import duckdb; conn = duckdb.connect(); conn.execute('CREATE TEMP TABLE test AS (WITH base AS (SELECT reportDate, sentence, sentenceID, docID, UNNEST(tickers) AS ticker FROM read_parquet(\"data/df_filings_full.parquet\") WHERE tickers IS NOT NULL AND len(tickers) > 0) SELECT * FROM base WHERE ticker IN (\"AAPL\", \"META\", \"TSLA\", \"NVDA\", \"AMZN\") LIMIT 5)'); result = conn.execute('SELECT docID, regexp_extract(docID, \"_(\\d{4})$\", 1) as year FROM test').fetchall(); [print(f'docID: {r[0]}, year: {r[1]}') for r in result]
